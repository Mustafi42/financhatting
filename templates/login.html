{% extends "base.html" %}
{% block title %}GiriÅŸ â€¢ Financhatting{% endblock %}

{% block content %}
<div class="page">
  <div class="wrap">
    <div class="card">
      <h1>ğŸ” GiriÅŸ Yap</h1>
      <p class="muted">HesabÄ±nla giriÅŸ yap.</p>

      <label class="field">
        <span>KullanÄ±cÄ± adÄ±</span>
        <input id="username" placeholder="mustafi42" autocomplete="username" />
      </label>

      <label class="field">
        <span>Åifre</span>
        <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
      </label>

      <div class="actions">
        <button class="btn btn-primary" id="btnLogin">GiriÅŸ</button>
        <a class="btn btn-ghost" href="/register">KayÄ±t Ol</a>
      </div>

      <div id="msg" class="msg" style="display:none;"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .page { padding: 20px 6px 60px; }
  .wrap { max-width: 520px; margin: 0 auto; }
  .card {
    background: linear-gradient(145deg, var(--panel) 0%, var(--panel2) 100%);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 18px;
  }
  h1 { margin: 0 0 6px; color: var(--green); text-shadow: 0 0 20px rgba(16, 185, 129, 0.25); }
  .muted { color: var(--muted); margin: 0 0 14px; }
  .field { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
  .field span { color: var(--muted); font-weight: 900; }
  input {
    border: 1px solid var(--border);
    background: rgba(15, 23, 42, 0.35);
    color: var(--text);
    border-radius: 14px;
    padding: 12px 14px;
    outline: none;
    font-family: inherit;
  }
  .actions { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 10px; }
  .msg {
    margin-top: 12px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(239, 68, 68, 0.65);
    background: rgba(239, 68, 68, 0.12);
    color: #fca5a5;
    font-weight: 900;
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  async function apiPost(url, payload) {
    const r = await fetch(url, {
      method: "POST",
      credentials: "include",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload || {}),
    });
    if (!r.ok) throw new Error(await r.text());
    return await r.json();
  }
  
  function showMsg(t) {
    const m = document.getElementById("msg");
    m.textContent = t;
    m.style.display = "block";
  }
  
  async function login() {
    const username = (document.getElementById("username").value || "").trim();
    const password = (document.getElementById("password").value || "").trim();
    
    if (!username || !password) {
      return showMsg("KullanÄ±cÄ± adÄ± ve ÅŸifre gerekli.");
    }
    
    try {
      document.getElementById("btnLogin").disabled = true;
      await apiPost("/api/auth/login", { username, password });
      window.location.href = "/feed";
    } catch (e) {
      console.error(e);
      showMsg("GiriÅŸ baÅŸarÄ±sÄ±z. Bilgileri kontrol et.");
    } finally {
      document.getElementById("btnLogin").disabled = false;
    }
  }
  
  document.getElementById("btnLogin").onclick = login;
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") login();
  });
</script>
{% endblock %}
