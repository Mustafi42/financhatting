{% extends "base.html" %}
{% block title %}GiriÅŸ Yap â€¢ Financhatting{% endblock %}

{% block content %}
<div class="page">
  <div class="wrap">
    <div class="card">
      <h1>ðŸ‘‹ HoÅŸ Geldiniz</h1>
      <p class="muted">HesabÄ±nÄ±za giriÅŸ yapÄ±n.</p>

      <label class="field">
        <span>KullanÄ±cÄ± AdÄ±</span>
        <input id="username" placeholder="kullaniciadi" autocomplete="username" />
      </label>

      <label class="field">
        <span>Åžifre</span>
        <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
      </label>

      <div class="actions">
        <button class="btn btn-primary" id="btnLogin">GiriÅŸ Yap</button>
        <a class="btn btn-ghost" href="/register">Hesap OluÅŸtur</a>
      </div>

      <div id="msg" class="msg" style="display:none;"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .page { padding: 20px 6px 60px; }
  .wrap { max-width: 480px; margin: 0 auto; }
  .card {
    background: linear-gradient(145deg, var(--panel) 0%, var(--panel2) 100%);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
  }
  h1 { 
    margin: 0 0 8px; 
    color: var(--green); 
    text-shadow: 0 0 20px rgba(16, 185, 129, 0.25);
    font-size: 1.8em;
  }
  .muted { 
    color: var(--muted); 
    margin: 0 0 24px;
    font-size: 0.95em;
  }
  .field { 
    display: flex; 
    flex-direction: column; 
    gap: 8px; 
    margin-bottom: 16px; 
  }
  .field span { 
    color: var(--text); 
    font-weight: 600;
    font-size: 0.9em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  input {
    border: 1px solid var(--border);
    background: rgba(15, 23, 42, 0.35);
    color: var(--text);
    border-radius: 12px;
    padding: 14px 16px;
    outline: none;
    font-family: inherit;
    font-size: 1em;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }
  input:focus {
    border-color: var(--green);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }
  .actions { 
    display: flex; 
    gap: 10px; 
    flex-wrap: wrap; 
    align-items: center; 
    margin-top: 20px; 
  }
  .msg {
    margin-top: 16px;
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid rgba(239, 68, 68, 0.65);
    background: rgba(239, 68, 68, 0.12);
    color: #fca5a5;
    font-weight: 600;
    font-size: 0.9em;
  }
  
  @media (max-width: 768px) {
    .wrap { max-width: 100%; }
    .card { padding: 20px; }
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  async function apiPost(url, payload) {
    const r = await fetch(url, {
      method: "POST",
      credentials: "include",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload || {}),
    });
    if (!r.ok) throw new Error(await r.text());
    return await r.json();
  }
  
  function showMsg(t) {
    const m = document.getElementById("msg");
    m.textContent = t;
    m.style.display = "block";
  }
  
  async function login() {
    const username = (document.getElementById("username").value || "").trim().toLowerCase();
    const password = (document.getElementById("password").value || "").trim();
    
    if (!username || !password) {
      return showMsg("LÃ¼tfen kullanÄ±cÄ± adÄ± ve ÅŸifre girin.");
    }
    
    try {
      document.getElementById("btnLogin").disabled = true;
      await apiPost("/api/auth/login", { username, password });
      window.location.href = "/feed";
    } catch (e) {
      console.error(e);
      showMsg("GiriÅŸ baÅŸarÄ±sÄ±z. KullanÄ±cÄ± adÄ± veya ÅŸifre hatalÄ±.");
    } finally {
      document.getElementById("btnLogin").disabled = false;
    }
  }
  
  document.getElementById("btnLogin").onclick = login;
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") login();
  });
</script>
{% endblock %}
