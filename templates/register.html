{% extends "base.html" %}
{% block title %}Kayƒ±t Ol ‚Ä¢ Financhatting{% endblock %}

{% block content %}
<div class="page">
  <div class="wrap">
    <div class="card">
      <h1>üîê Kayƒ±t Ol</h1>
      <p class="muted">Finansal sosyal aƒüa katƒ±lƒ±n.</p>

      <label class="field">
        <span>Ad Soyad</span>
        <input id="full_name" placeholder="Ad Soyad" autocomplete="name" />
      </label>

      <label class="field">
        <span>Kullanƒ±cƒ± Adƒ±</span>
        <input id="username" placeholder="kullaniciadi" autocomplete="username" />
        <small>K√º√ß√ºk harf, rakam ve _ kullanabilirsiniz.</small>
      </label>

      <label class="field">
        <span>≈ûifre</span>
        <input id="password" type="password" placeholder="Minimum 6 karakter" autocomplete="new-password" />
      </label>

      <div class="actions">
        <button class="btn btn-primary" id="btnRegister">Kayƒ±t Ol</button>
        <a class="btn btn-ghost" href="/login">Zaten hesabƒ±m var</a>
      </div>

      <div id="msg" class="msg" style="display:none;"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .page { padding: 20px 6px 60px; }
  .wrap { max-width: 480px; margin: 0 auto; }
  .card {
    background: linear-gradient(145deg, var(--panel) 0%, var(--panel2) 100%);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
  }
  h1 { 
    margin: 0 0 8px; 
    color: var(--green); 
    text-shadow: 0 0 20px rgba(16, 185, 129, 0.25);
    font-size: 1.8em;
  }
  .muted { 
    color: var(--muted); 
    margin: 0 0 24px;
    font-size: 0.95em;
  }
  .field { 
    display: flex; 
    flex-direction: column; 
    gap: 8px; 
    margin-bottom: 16px; 
  }
  .field span { 
    color: var(--text); 
    font-weight: 600;
    font-size: 0.9em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  input {
    border: 1px solid var(--border);
    background: rgba(15, 23, 42, 0.35);
    color: var(--text);
    border-radius: 12px;
    padding: 14px 16px;
    outline: none;
    font-family: inherit;
    font-size: 1em;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }
  input:focus {
    border-color: var(--green);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }
  small { 
    color: var(--muted2); 
    font-size: 0.85em;
    margin-top: -4px;
  }
  .actions { 
    display: flex; 
    gap: 10px; 
    flex-wrap: wrap; 
    align-items: center; 
    margin-top: 20px; 
  }
  .msg {
    margin-top: 16px;
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid rgba(239, 68, 68, 0.65);
    background: rgba(239, 68, 68, 0.12);
    color: #fca5a5;
    font-weight: 600;
    font-size: 0.9em;
  }
  
  @media (max-width: 768px) {
    .wrap { max-width: 100%; }
    .card { padding: 20px; }
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  async function apiPost(url, payload) {
    const r = await fetch(url, {
      method: "POST",
      credentials: "include",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload || {}),
    });
    if (!r.ok) throw new Error(await r.text());
    return await r.json();
  }
  
  function showMsg(t) {
    const m = document.getElementById("msg");
    m.textContent = t;
    m.style.display = "block";
  }
  
  async function register() {
    const full_name = (document.getElementById("full_name").value || "").trim();
    const username = (document.getElementById("username").value || "").trim().toLowerCase();
    const password = (document.getElementById("password").value || "").trim();
    
    if (!full_name || !username || !password) {
      return showMsg("L√ºtfen t√ºm alanlarƒ± doldurun.");
    }
    
    if (username.length < 3) {
      return showMsg("Kullanƒ±cƒ± adƒ± en az 3 karakter olmalƒ±.");
    }
    
    if (password.length < 6) {
      return showMsg("≈ûifre en az 6 karakter olmalƒ±.");
    }
    
    try {
      document.getElementById("btnRegister").disabled = true;
      await apiPost("/api/auth/register", { full_name, username, password });
      window.location.href = "/feed";
    } catch (e) {
      console.error(e);
      showMsg("Kayƒ±t ba≈üarƒ±sƒ±z. Bu kullanƒ±cƒ± adƒ± alƒ±nmƒ±≈ü olabilir.");
    } finally {
      document.getElementById("btnRegister").disabled = false;
    }
  }
  
  document.getElementById("btnRegister").onclick = register;
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") register();
  });
</script>
{% endblock %}
